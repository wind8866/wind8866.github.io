<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>safe-buffer [![travis][travis-image]][travis-url] [![npm][npm-image]][npm-url] [![downloads][downloads-image]][downloads-url] [![javascript style guide][standard-image]][standard-url] | Wind</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="起风了的个人博客与学习笔记">
    
    <link rel="preload" href="/assets/css/0.styles.c1092872.css" as="style"><link rel="preload" href="/assets/js/app.2e3db3d9.js" as="script"><link rel="preload" href="/assets/js/2.65dda3ac.js" as="script"><link rel="preload" href="/assets/js/151.809252f7.js" as="script"><link rel="prefetch" href="/assets/js/10.357b5774.js"><link rel="prefetch" href="/assets/js/100.184cd071.js"><link rel="prefetch" href="/assets/js/101.3866021b.js"><link rel="prefetch" href="/assets/js/102.b6f389c5.js"><link rel="prefetch" href="/assets/js/103.2cb86a45.js"><link rel="prefetch" href="/assets/js/104.8035c95f.js"><link rel="prefetch" href="/assets/js/105.58071765.js"><link rel="prefetch" href="/assets/js/106.e585b16a.js"><link rel="prefetch" href="/assets/js/107.b85532b3.js"><link rel="prefetch" href="/assets/js/108.a353ea24.js"><link rel="prefetch" href="/assets/js/109.b9b30406.js"><link rel="prefetch" href="/assets/js/11.079c2ba9.js"><link rel="prefetch" href="/assets/js/110.0cde913d.js"><link rel="prefetch" href="/assets/js/111.31bdaf1f.js"><link rel="prefetch" href="/assets/js/112.e7193085.js"><link rel="prefetch" href="/assets/js/113.6a815f50.js"><link rel="prefetch" href="/assets/js/114.a826c59d.js"><link rel="prefetch" href="/assets/js/115.1bbd6b0a.js"><link rel="prefetch" href="/assets/js/116.8b100930.js"><link rel="prefetch" href="/assets/js/117.d8e7f686.js"><link rel="prefetch" href="/assets/js/118.7e9f15d0.js"><link rel="prefetch" href="/assets/js/119.89659594.js"><link rel="prefetch" href="/assets/js/12.6a73bcc5.js"><link rel="prefetch" href="/assets/js/120.23d949d4.js"><link rel="prefetch" href="/assets/js/121.989e6869.js"><link rel="prefetch" href="/assets/js/122.5feb9878.js"><link rel="prefetch" href="/assets/js/123.6ea91031.js"><link rel="prefetch" href="/assets/js/124.e6cd6192.js"><link rel="prefetch" href="/assets/js/125.008b851d.js"><link rel="prefetch" href="/assets/js/126.c6b6b51a.js"><link rel="prefetch" href="/assets/js/127.c0c6173a.js"><link rel="prefetch" href="/assets/js/128.596744f0.js"><link rel="prefetch" href="/assets/js/129.52675432.js"><link rel="prefetch" href="/assets/js/13.27562c3a.js"><link rel="prefetch" href="/assets/js/130.046cbb37.js"><link rel="prefetch" href="/assets/js/131.77fe5805.js"><link rel="prefetch" href="/assets/js/132.ddaf01b1.js"><link rel="prefetch" href="/assets/js/133.7b572704.js"><link rel="prefetch" href="/assets/js/134.a5bb753b.js"><link rel="prefetch" href="/assets/js/135.0b06c726.js"><link rel="prefetch" href="/assets/js/136.42a5ef49.js"><link rel="prefetch" href="/assets/js/137.12f7f4dd.js"><link rel="prefetch" href="/assets/js/138.264e490a.js"><link rel="prefetch" href="/assets/js/139.bad5c759.js"><link rel="prefetch" href="/assets/js/14.dc51ffe2.js"><link rel="prefetch" href="/assets/js/140.0101e64d.js"><link rel="prefetch" href="/assets/js/141.3f5dcc75.js"><link rel="prefetch" href="/assets/js/142.dc421e7a.js"><link rel="prefetch" href="/assets/js/143.f36e30af.js"><link rel="prefetch" href="/assets/js/144.fb7c9a46.js"><link rel="prefetch" href="/assets/js/145.bee49609.js"><link rel="prefetch" href="/assets/js/146.aeaddf99.js"><link rel="prefetch" href="/assets/js/147.e2017cca.js"><link rel="prefetch" href="/assets/js/148.c5bef4c6.js"><link rel="prefetch" href="/assets/js/149.2cbfeae5.js"><link rel="prefetch" href="/assets/js/15.4812fd27.js"><link rel="prefetch" href="/assets/js/150.7b3aad9a.js"><link rel="prefetch" href="/assets/js/152.5e8565a8.js"><link rel="prefetch" href="/assets/js/153.cc80c8db.js"><link rel="prefetch" href="/assets/js/154.0fc42f42.js"><link rel="prefetch" href="/assets/js/155.1697681c.js"><link rel="prefetch" href="/assets/js/156.f6421d21.js"><link rel="prefetch" href="/assets/js/157.7b90b7b5.js"><link rel="prefetch" href="/assets/js/158.de953b27.js"><link rel="prefetch" href="/assets/js/159.bc40b166.js"><link rel="prefetch" href="/assets/js/16.cd7c3771.js"><link rel="prefetch" href="/assets/js/160.c7814b2b.js"><link rel="prefetch" href="/assets/js/161.0a57399a.js"><link rel="prefetch" href="/assets/js/162.79baf973.js"><link rel="prefetch" href="/assets/js/163.9a1f3202.js"><link rel="prefetch" href="/assets/js/164.353103d9.js"><link rel="prefetch" href="/assets/js/165.6bc61007.js"><link rel="prefetch" href="/assets/js/166.7895afb8.js"><link rel="prefetch" href="/assets/js/167.692082b5.js"><link rel="prefetch" href="/assets/js/168.4781ef85.js"><link rel="prefetch" href="/assets/js/169.8538eee4.js"><link rel="prefetch" href="/assets/js/17.49eafbb6.js"><link rel="prefetch" href="/assets/js/170.dd5b9669.js"><link rel="prefetch" href="/assets/js/171.e670b681.js"><link rel="prefetch" href="/assets/js/172.30df864d.js"><link rel="prefetch" href="/assets/js/173.6113670d.js"><link rel="prefetch" href="/assets/js/174.8ed484e2.js"><link rel="prefetch" href="/assets/js/175.5c90b7ba.js"><link rel="prefetch" href="/assets/js/176.bc2e45bd.js"><link rel="prefetch" href="/assets/js/177.fe48b207.js"><link rel="prefetch" href="/assets/js/178.6234883e.js"><link rel="prefetch" href="/assets/js/179.553448de.js"><link rel="prefetch" href="/assets/js/18.ea171268.js"><link rel="prefetch" href="/assets/js/180.769bb573.js"><link rel="prefetch" href="/assets/js/181.8e4552c5.js"><link rel="prefetch" href="/assets/js/182.9761430c.js"><link rel="prefetch" href="/assets/js/183.082e811d.js"><link rel="prefetch" href="/assets/js/184.c167f336.js"><link rel="prefetch" href="/assets/js/185.8f32c842.js"><link rel="prefetch" href="/assets/js/186.5f2ff328.js"><link rel="prefetch" href="/assets/js/187.6de4cc20.js"><link rel="prefetch" href="/assets/js/188.e388d882.js"><link rel="prefetch" href="/assets/js/189.f52cefaa.js"><link rel="prefetch" href="/assets/js/19.d5f74352.js"><link rel="prefetch" href="/assets/js/190.c015f68f.js"><link rel="prefetch" href="/assets/js/20.c85370a3.js"><link rel="prefetch" href="/assets/js/21.6d096356.js"><link rel="prefetch" href="/assets/js/22.b08eb7e0.js"><link rel="prefetch" href="/assets/js/23.098f1ac5.js"><link rel="prefetch" href="/assets/js/24.96d1e6e6.js"><link rel="prefetch" href="/assets/js/25.69e73744.js"><link rel="prefetch" href="/assets/js/26.4aacb5c1.js"><link rel="prefetch" href="/assets/js/27.2df4926d.js"><link rel="prefetch" href="/assets/js/28.a7f4c564.js"><link rel="prefetch" href="/assets/js/29.e6b2c078.js"><link rel="prefetch" href="/assets/js/3.e3f1b501.js"><link rel="prefetch" href="/assets/js/30.293341de.js"><link rel="prefetch" href="/assets/js/31.5b49b4d4.js"><link rel="prefetch" href="/assets/js/32.0061bb69.js"><link rel="prefetch" href="/assets/js/33.0f17e027.js"><link rel="prefetch" href="/assets/js/34.f5dae4f0.js"><link rel="prefetch" href="/assets/js/35.0f6db645.js"><link rel="prefetch" href="/assets/js/36.6d88157c.js"><link rel="prefetch" href="/assets/js/37.7b63a8c7.js"><link rel="prefetch" href="/assets/js/38.0ebf6d81.js"><link rel="prefetch" href="/assets/js/39.30b3a587.js"><link rel="prefetch" href="/assets/js/4.9cd35a0b.js"><link rel="prefetch" href="/assets/js/40.2151fb6c.js"><link rel="prefetch" href="/assets/js/41.d567b987.js"><link rel="prefetch" href="/assets/js/42.d7c30226.js"><link rel="prefetch" href="/assets/js/43.3be40283.js"><link rel="prefetch" href="/assets/js/44.d16c1776.js"><link rel="prefetch" href="/assets/js/45.e530ad74.js"><link rel="prefetch" href="/assets/js/46.b9346c31.js"><link rel="prefetch" href="/assets/js/47.fc4881ab.js"><link rel="prefetch" href="/assets/js/48.81663997.js"><link rel="prefetch" href="/assets/js/49.d3f74e53.js"><link rel="prefetch" href="/assets/js/5.f9d6ad53.js"><link rel="prefetch" href="/assets/js/50.31793dc1.js"><link rel="prefetch" href="/assets/js/51.df87964d.js"><link rel="prefetch" href="/assets/js/52.a9d4b0f0.js"><link rel="prefetch" href="/assets/js/53.df8690a4.js"><link rel="prefetch" href="/assets/js/54.6880d9e6.js"><link rel="prefetch" href="/assets/js/55.df4441e7.js"><link rel="prefetch" href="/assets/js/56.f18cabea.js"><link rel="prefetch" href="/assets/js/57.e12d025d.js"><link rel="prefetch" href="/assets/js/58.08d812ab.js"><link rel="prefetch" href="/assets/js/59.d81d6d05.js"><link rel="prefetch" href="/assets/js/6.83abd156.js"><link rel="prefetch" href="/assets/js/60.cb00b6c5.js"><link rel="prefetch" href="/assets/js/61.4dead28d.js"><link rel="prefetch" href="/assets/js/62.1651aecc.js"><link rel="prefetch" href="/assets/js/63.49afe57f.js"><link rel="prefetch" href="/assets/js/64.ffd69c1f.js"><link rel="prefetch" href="/assets/js/65.dae6357a.js"><link rel="prefetch" href="/assets/js/66.63f2d3ed.js"><link rel="prefetch" href="/assets/js/67.7076b9a4.js"><link rel="prefetch" href="/assets/js/68.b22bcd3f.js"><link rel="prefetch" href="/assets/js/69.033db5fa.js"><link rel="prefetch" href="/assets/js/7.7ad3d79d.js"><link rel="prefetch" href="/assets/js/70.9affc24a.js"><link rel="prefetch" href="/assets/js/71.3a37921f.js"><link rel="prefetch" href="/assets/js/72.cea5729d.js"><link rel="prefetch" href="/assets/js/73.99ec9c15.js"><link rel="prefetch" href="/assets/js/74.23164362.js"><link rel="prefetch" href="/assets/js/75.f01fdfdb.js"><link rel="prefetch" href="/assets/js/76.a4b66f24.js"><link rel="prefetch" href="/assets/js/77.7eb7460d.js"><link rel="prefetch" href="/assets/js/78.1f919b39.js"><link rel="prefetch" href="/assets/js/79.de000184.js"><link rel="prefetch" href="/assets/js/8.18922c3e.js"><link rel="prefetch" href="/assets/js/80.6259f5be.js"><link rel="prefetch" href="/assets/js/81.5bec1644.js"><link rel="prefetch" href="/assets/js/82.801f08b8.js"><link rel="prefetch" href="/assets/js/83.1574b520.js"><link rel="prefetch" href="/assets/js/84.92bc4d2d.js"><link rel="prefetch" href="/assets/js/85.fb1df670.js"><link rel="prefetch" href="/assets/js/86.09ca4cc5.js"><link rel="prefetch" href="/assets/js/87.adbfde0a.js"><link rel="prefetch" href="/assets/js/88.f9a44acf.js"><link rel="prefetch" href="/assets/js/89.d8bdb4e6.js"><link rel="prefetch" href="/assets/js/9.69d52509.js"><link rel="prefetch" href="/assets/js/90.706a6473.js"><link rel="prefetch" href="/assets/js/91.0c4f8a41.js"><link rel="prefetch" href="/assets/js/92.aeee86f2.js"><link rel="prefetch" href="/assets/js/93.f5feedf8.js"><link rel="prefetch" href="/assets/js/94.52dcd6be.js"><link rel="prefetch" href="/assets/js/95.18b802b4.js"><link rel="prefetch" href="/assets/js/96.c317dec0.js"><link rel="prefetch" href="/assets/js/97.1baa77b7.js"><link rel="prefetch" href="/assets/js/98.c566e725.js"><link rel="prefetch" href="/assets/js/99.315d3c8c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c1092872.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Wind</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  Blog
</a></div><div class="nav-item"><a href="/javascript/" class="nav-link">
  现代JS教程📝
</a></div><div class="nav-item"><a href="https://github.com/wind8866" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  Blog
</a></div><div class="nav-item"><a href="/javascript/" class="nav-link">
  现代JS教程📝
</a></div><div class="nav-item"><a href="https://github.com/wind8866" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="safe-buffer"><a href="#safe-buffer" class="header-anchor">#</a> safe-buffer <a href="https://travis-ci.org/feross/safe-buffer" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/travis/feross/safe-buffer/master.svg" alt="travis"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://npmjs.org/package/safe-buffer" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/npm/v/safe-buffer.svg" alt="npm"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://npmjs.org/package/safe-buffer" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/npm/dm/safe-buffer.svg" alt="downloads"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://standardjs.com" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/code_style-standard-brightgreen.svg" alt="javascript style guide"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h1> <h4 id="safer-node-js-buffer-api"><a href="#safer-node-js-buffer-api" class="header-anchor">#</a> Safer Node.js Buffer API</h4> <p><strong>Use the new Node.js Buffer APIs (<code>Buffer.from</code>, <code>Buffer.alloc</code>,<br> <code>Buffer.allocUnsafe</code>, <code>Buffer.allocUnsafeSlow</code>) in all versions of Node.js.</strong></p> <p><strong>Uses the built-in implementation when available.</strong></p> <h2 id="install"><a href="#install" class="header-anchor">#</a> install</h2> <div class="language- extra-class"><pre class="language-text"><code>npm install safe-buffer
</code></pre></div><h2 id="usage"><a href="#usage" class="header-anchor">#</a> usage</h2> <p>The goal of this package is to provide a safe replacement for the node.js <code>Buffer</code>.</p> <p>It's a drop-in replacement for <code>Buffer</code>. You can use it by adding one <code>require</code> line to<br>
the top of your node.js modules:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> Buffer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'safe-buffer'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Buffer

<span class="token comment">// Existing buffer code will continue to work without issues:</span>

<span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token string">'hey'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token comment">// create an uninitialized buffer (potentially unsafe)</span>

<span class="token comment">// But you can use these new explicit APIs to make clear what you want:</span>

Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'hey'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span> <span class="token comment">// convert from many types to a Buffer</span>
Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token comment">// create a zero-filled buffer (safe)</span>
Buffer<span class="token punctuation">.</span><span class="token function">allocUnsafe</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token comment">// create an uninitialized buffer (potentially unsafe)</span>
</code></pre></div><h2 id="api"><a href="#api" class="header-anchor">#</a> api</h2> <h3 id="class-method-buffer-from-array"><a href="#class-method-buffer-from-array" class="header-anchor">#</a> Class Method: Buffer.from(array)</h3> <ul><li><code>array</code> {Array}</li></ul> <p>Allocates a new <code>Buffer</code> using an <code>array</code> of octets.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> buf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0x62</span><span class="token punctuation">,</span><span class="token number">0x75</span><span class="token punctuation">,</span><span class="token number">0x66</span><span class="token punctuation">,</span><span class="token number">0x66</span><span class="token punctuation">,</span><span class="token number">0x65</span><span class="token punctuation">,</span><span class="token number">0x72</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// creates a new Buffer containing ASCII bytes</span>
  <span class="token comment">// ['b','u','f','f','e','r']</span>
</code></pre></div><p>A <code>TypeError</code> will be thrown if <code>array</code> is not an <code>Array</code>.</p> <h3 id="class-method-buffer-from-arraybuffer-byteoffset-length"><a href="#class-method-buffer-from-arraybuffer-byteoffset-length" class="header-anchor">#</a> Class Method: Buffer.from(arrayBuffer[, byteOffset[, length]])</h3> <ul><li><code>arrayBuffer</code> {ArrayBuffer} The <code>.buffer</code> property of a <code>TypedArray</code> or<br>
a <code>new ArrayBuffer()</code></li> <li><code>byteOffset</code> {Number} Default: <code>0</code></li> <li><code>length</code> {Number} Default: <code>arrayBuffer.length - byteOffset</code></li></ul> <p>When passed a reference to the <code>.buffer</code> property of a <code>TypedArray</code> instance,<br>
the newly created <code>Buffer</code> will share the same allocated memory as the<br>
TypedArray.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint16Array</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">5000</span><span class="token punctuation">;</span>
arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">4000</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> buf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// shares the memory with arr;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Prints: &lt;Buffer 88 13 a0 0f&gt;</span>

<span class="token comment">// changing the TypedArray changes the Buffer also</span>
arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">6000</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Prints: &lt;Buffer 88 13 70 17&gt;</span>
</code></pre></div><p>The optional <code>byteOffset</code> and <code>length</code> arguments specify a memory range within<br>
the <code>arrayBuffer</code> that will be shared by the <code>Buffer</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> ab <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> buf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>ab<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Prints: 2</span>
</code></pre></div><p>A <code>TypeError</code> will be thrown if <code>arrayBuffer</code> is not an <code>ArrayBuffer</code>.</p> <h3 id="class-method-buffer-from-buffer"><a href="#class-method-buffer-from-buffer" class="header-anchor">#</a> Class Method: Buffer.from(buffer)</h3> <ul><li><code>buffer</code> {Buffer}</li></ul> <p>Copies the passed <code>buffer</code> data onto a new <code>Buffer</code> instance.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> buf1 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'buffer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> buf2 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>buf1<span class="token punctuation">)</span><span class="token punctuation">;</span>

buf1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x61</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf1<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 'auffer'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf2<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 'buffer' (copy is not changed)</span>
</code></pre></div><p>A <code>TypeError</code> will be thrown if <code>buffer</code> is not a <code>Buffer</code>.</p> <h3 id="class-method-buffer-from-str-encoding"><a href="#class-method-buffer-from-str-encoding" class="header-anchor">#</a> Class Method: Buffer.from(str[, encoding])</h3> <ul><li><code>str</code> {String} String to encode.</li> <li><code>encoding</code> {String} Encoding to use, Default: <code>'utf8'</code></li></ul> <p>Creates a new <code>Buffer</code> containing the given JavaScript string <code>str</code>. If<br>
provided, the <code>encoding</code> parameter identifies the character encoding.<br>
If not provided, <code>encoding</code> defaults to <code>'utf8'</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> buf1 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'this is a tést'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf1<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// prints: this is a tést</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf1<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'ascii'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// prints: this is a tC)st</span>

<span class="token keyword">const</span> buf2 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'7468697320697320612074c3a97374'</span><span class="token punctuation">,</span> <span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf2<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// prints: this is a tést</span>
</code></pre></div><p>A <code>TypeError</code> will be thrown if <code>str</code> is not a string.</p> <h3 id="class-method-buffer-alloc-size-fill-encoding"><a href="#class-method-buffer-alloc-size-fill-encoding" class="header-anchor">#</a> Class Method: Buffer.alloc(size[, fill[, encoding]])</h3> <ul><li><code>size</code> {Number}</li> <li><code>fill</code> {Value} Default: <code>undefined</code></li> <li><code>encoding</code> {String} Default: <code>utf8</code></li></ul> <p>Allocates a new <code>Buffer</code> of <code>size</code> bytes. If <code>fill</code> is <code>undefined</code>, the<br> <code>Buffer</code> will be <em>zero-filled</em>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> buf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// &lt;Buffer 00 00 00 00 00&gt;</span>
</code></pre></div><p>The <code>size</code> must be less than or equal to the value of<br> <code>require('buffer').kMaxLength</code> (on 64-bit architectures, <code>kMaxLength</code> is<br> <code>(2^31)-1</code>). Otherwise, a [<code>RangeError</code>][] is thrown. A zero-length Buffer will<br>
be created if a <code>size</code> less than or equal to 0 is specified.</p> <p>If <code>fill</code> is specified, the allocated <code>Buffer</code> will be initialized by calling<br> <code>buf.fill(fill)</code>. See [<code>buf.fill()</code>][] for more information.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> buf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// &lt;Buffer 61 61 61 61 61&gt;</span>
</code></pre></div><p>If both <code>fill</code> and <code>encoding</code> are specified, the allocated <code>Buffer</code> will be<br>
initialized by calling <code>buf.fill(fill, encoding)</code>. For example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> buf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token string">'aGVsbG8gd29ybGQ='</span><span class="token punctuation">,</span> <span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// &lt;Buffer 68 65 6c 6c 6f 20 77 6f 72 6c 64&gt;</span>
</code></pre></div><p>Calling <code>Buffer.alloc(size)</code> can be significantly slower than the alternative<br> <code>Buffer.allocUnsafe(size)</code> but ensures that the newly created <code>Buffer</code> instance<br>
contents will <em>never contain sensitive data</em>.</p> <p>A <code>TypeError</code> will be thrown if <code>size</code> is not a number.</p> <h3 id="class-method-buffer-allocunsafe-size"><a href="#class-method-buffer-allocunsafe-size" class="header-anchor">#</a> Class Method: Buffer.allocUnsafe(size)</h3> <ul><li><code>size</code> {Number}</li></ul> <p>Allocates a new <em>non-zero-filled</em> <code>Buffer</code> of <code>size</code> bytes.  The <code>size</code> must<br>
be less than or equal to the value of <code>require('buffer').kMaxLength</code> (on 64-bit<br>
architectures, <code>kMaxLength</code> is <code>(2^31)-1</code>). Otherwise, a [<code>RangeError</code>][] is<br>
thrown. A zero-length Buffer will be created if a <code>size</code> less than or equal to<br>
0 is specified.</p> <p>The underlying memory for <code>Buffer</code> instances created in this way is <em>not<br>
initialized</em>. The contents of the newly created <code>Buffer</code> are unknown and<br> <em>may contain sensitive data</em>. Use [<code>buf.fill(0)</code>][] to initialize such<br> <code>Buffer</code> instances to zeroes.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> buf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">allocUnsafe</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// &lt;Buffer 78 e0 82 02 01&gt;</span>
  <span class="token comment">// (octets will be different, every time)</span>
buf<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// &lt;Buffer 00 00 00 00 00&gt;</span>
</code></pre></div><p>A <code>TypeError</code> will be thrown if <code>size</code> is not a number.</p> <p>Note that the <code>Buffer</code> module pre-allocates an internal <code>Buffer</code> instance of<br>
size <code>Buffer.poolSize</code> that is used as a pool for the fast allocation of new<br> <code>Buffer</code> instances created using <code>Buffer.allocUnsafe(size)</code> (and the deprecated<br> <code>new Buffer(size)</code> constructor) only when <code>size</code> is less than or equal to<br> <code>Buffer.poolSize &gt;&gt; 1</code> (floor of <code>Buffer.poolSize</code> divided by two). The default<br>
value of <code>Buffer.poolSize</code> is <code>8192</code> but can be modified.</p> <p>Use of this pre-allocated internal memory pool is a key difference between<br>
calling <code>Buffer.alloc(size, fill)</code> vs. <code>Buffer.allocUnsafe(size).fill(fill)</code>.<br>
Specifically, <code>Buffer.alloc(size, fill)</code> will <em>never</em> use the internal Buffer<br>
pool, while <code>Buffer.allocUnsafe(size).fill(fill)</code> <em>will</em> use the internal<br>
Buffer pool if <code>size</code> is less than or equal to half <code>Buffer.poolSize</code>. The<br>
difference is subtle but can be important when an application requires the<br>
additional performance that <code>Buffer.allocUnsafe(size)</code> provides.</p> <h3 id="class-method-buffer-allocunsafeslow-size"><a href="#class-method-buffer-allocunsafeslow-size" class="header-anchor">#</a> Class Method: Buffer.allocUnsafeSlow(size)</h3> <ul><li><code>size</code> {Number}</li></ul> <p>Allocates a new <em>non-zero-filled</em> and non-pooled <code>Buffer</code> of <code>size</code> bytes.  The<br> <code>size</code> must be less than or equal to the value of<br> <code>require('buffer').kMaxLength</code> (on 64-bit architectures, <code>kMaxLength</code> is<br> <code>(2^31)-1</code>). Otherwise, a [<code>RangeError</code>][] is thrown. A zero-length Buffer will<br>
be created if a <code>size</code> less than or equal to 0 is specified.</p> <p>The underlying memory for <code>Buffer</code> instances created in this way is <em>not<br>
initialized</em>. The contents of the newly created <code>Buffer</code> are unknown and<br> <em>may contain sensitive data</em>. Use [<code>buf.fill(0)</code>][] to initialize such<br> <code>Buffer</code> instances to zeroes.</p> <p>When using <code>Buffer.allocUnsafe()</code> to allocate new <code>Buffer</code> instances,<br>
allocations under 4KB are, by default, sliced from a single pre-allocated<br> <code>Buffer</code>. This allows applications to avoid the garbage collection overhead of<br>
creating many individually allocated Buffers. This approach improves both<br>
performance and memory usage by eliminating the need to track and cleanup as<br>
many <code>Persistent</code> objects.</p> <p>However, in the case where a developer may need to retain a small chunk of<br>
memory from a pool for an indeterminate amount of time, it may be appropriate<br>
to create an un-pooled Buffer instance using <code>Buffer.allocUnsafeSlow()</code> then<br>
copy out the relevant bits.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// need to keep around a few small chunks of memory</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'readable'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// allocate for retained data</span>
  <span class="token keyword">const</span> sb <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">allocUnsafeSlow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// copy the data into the new allocation</span>
  data<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>sb<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  store<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sb<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Use of <code>Buffer.allocUnsafeSlow()</code> should be used only as a last resort <em>after</em><br>
a developer has observed undue memory retention in their applications.</p> <p>A <code>TypeError</code> will be thrown if <code>size</code> is not a number.</p> <h3 id="all-the-rest"><a href="#all-the-rest" class="header-anchor">#</a> All the Rest</h3> <p>The rest of the <code>Buffer</code> API is exactly the same as in node.js.<br> <a href="https://nodejs.org/api/buffer.html" target="_blank" rel="noopener noreferrer">See the docs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="related-links"><a href="#related-links" class="header-anchor">#</a> Related links</h2> <ul><li><a href="https://github.com/nodejs/node/issues/4660" target="_blank" rel="noopener noreferrer">Node.js issue: Buffer(number) is unsafe<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/nodejs/node-eps/pull/4" target="_blank" rel="noopener noreferrer">Node.js Enhancement Proposal: Buffer.from/Buffer.alloc/Buffer.zalloc/Buffer() soft-deprecate<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="why-is-buffer-unsafe"><a href="#why-is-buffer-unsafe" class="header-anchor">#</a> Why is <code>Buffer</code> unsafe?</h2> <p>Today, the node.js <code>Buffer</code> constructor is overloaded to handle many different argument<br>
types like <code>String</code>, <code>Array</code>, <code>Object</code>, <code>TypedArrayView</code> (<code>Uint8Array</code>, etc.),<br> <code>ArrayBuffer</code>, and also <code>Number</code>.</p> <p>The API is optimized for convenience: you can throw any type at it, and it will try to do<br>
what you want.</p> <p>Because the Buffer constructor is so powerful, you often see code like this:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Convert UTF-8 strings to hex</span>
<span class="token keyword">function</span> <span class="token function">toHex</span> <span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>But what happens if <code>toHex</code> is called with a <code>Number</code> argument?</strong></em></p> <h3 id="remote-memory-disclosure"><a href="#remote-memory-disclosure" class="header-anchor">#</a> Remote Memory Disclosure</h3> <p>If an attacker can make your program call the <code>Buffer</code> constructor with a <code>Number</code><br>
argument, then they can make it allocate uninitialized memory from the node.js process.<br>
This could potentially disclose TLS private keys, user data, or database passwords.</p> <p>When the <code>Buffer</code> constructor is passed a <code>Number</code> argument, it returns an<br> <strong>UNINITIALIZED</strong> block of memory of the specified <code>size</code>. When you create a <code>Buffer</code> like<br>
this, you <strong>MUST</strong> overwrite the contents before returning it to the user.</p> <p>From the <a href="https://nodejs.org/api/buffer.html#buffer_new_buffer_size" target="_blank" rel="noopener noreferrer">node.js docs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</p> <blockquote><p><code>new Buffer(size)</code></p> <ul><li><code>size</code> Number</li></ul> <p>The underlying memory for <code>Buffer</code> instances created in this way is not initialized.<br> <strong>The contents of a newly created <code>Buffer</code> are unknown and could contain sensitive<br>
data.</strong> Use <code>buf.fill(0)</code> to initialize a Buffer to zeroes.</p></blockquote> <p>(Emphasis our own.)</p> <p>Whenever the programmer intended to create an uninitialized <code>Buffer</code> you often see code<br>
like this:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>

<span class="token comment">// Immediately overwrite the uninitialized buffer with data from another buffer</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> buf<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> otherBuf<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="would-this-ever-be-a-problem-in-real-code"><a href="#would-this-ever-be-a-problem-in-real-code" class="header-anchor">#</a> Would this ever be a problem in real code?</h3> <p>Yes. It's surprisingly common to forget to check the type of your variables in a<br>
dynamically-typed language like JavaScript.</p> <p>Usually the consequences of assuming the wrong type is that your program crashes with an<br>
uncaught exception. But the failure mode for forgetting to check the type of arguments to<br>
the <code>Buffer</code> constructor is more catastrophic.</p> <p>Here's an example of a vulnerable service that takes a JSON payload and converts it to<br>
hex:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Take a JSON payload {str: &quot;some string&quot;} and convert it to hex</span>
<span class="token keyword">var</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token string">''</span>
  req<span class="token punctuation">.</span><span class="token function">setEncoding</span><span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>
  req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    data <span class="token operator">+=</span> chunk
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> body <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span>body<span class="token punctuation">.</span>str<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span>
</code></pre></div><p>In this example, an http client just has to send:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;str&quot;</span><span class="token operator">:</span> <span class="token number">1000</span>
<span class="token punctuation">}</span>
</code></pre></div><p>and it will get back 1,000 bytes of uninitialized memory from the server.</p> <p>This is a very serious bug. It's similar in severity to the<br> <a href="http://heartbleed.com/" target="_blank" rel="noopener noreferrer">the Heartbleed bug<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> that allowed disclosure of OpenSSL process<br>
memory by remote attackers.</p> <h3 id="which-real-world-packages-were-vulnerable"><a href="#which-real-world-packages-were-vulnerable" class="header-anchor">#</a> Which real-world packages were vulnerable?</h3> <h4 id="bittorrent-dht"><a href="#bittorrent-dht" class="header-anchor">#</a> <a href="https://www.npmjs.com/package/bittorrent-dht" target="_blank" rel="noopener noreferrer"><code>bittorrent-dht</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h4> <p><a href="https://github.com/mafintosh" target="_blank" rel="noopener noreferrer">Mathias Buus<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and I<br>
(<a href="http://feross.org/" target="_blank" rel="noopener noreferrer">Feross Aboukhadijeh<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>) found this issue in one of our own packages,<br> <a href="https://www.npmjs.com/package/bittorrent-dht" target="_blank" rel="noopener noreferrer"><code>bittorrent-dht</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. The bug would allow<br>
anyone on the internet to send a series of messages to a user of <code>bittorrent-dht</code> and get<br>
them to reveal 20 bytes at a time of uninitialized memory from the node.js process.</p> <p>Here's<br> <a href="https://github.com/feross/bittorrent-dht/commit/6c7da04025d5633699800a99ec3fbadf70ad35b8" target="_blank" rel="noopener noreferrer">the commit<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br>
that fixed it. We released a new fixed version, created a<br> <a href="https://nodesecurity.io/advisories/68" target="_blank" rel="noopener noreferrer">Node Security Project disclosure<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, and deprecated all<br>
vulnerable versions on npm so users will get a warning to upgrade to a newer version.</p> <h4 id="ws"><a href="#ws" class="header-anchor">#</a> <a href="https://www.npmjs.com/package/ws" target="_blank" rel="noopener noreferrer"><code>ws</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h4> <p>That got us wondering if there were other vulnerable packages. Sure enough, within a short<br>
period of time, we found the same issue in <a href="https://www.npmjs.com/package/ws" target="_blank" rel="noopener noreferrer"><code>ws</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, the<br>
most popular WebSocket implementation in node.js.</p> <p>If certain APIs were called with <code>Number</code> parameters instead of <code>String</code> or <code>Buffer</code> as<br>
expected, then uninitialized server memory would be disclosed to the remote peer.</p> <p>These were the vulnerable methods:</p> <div class="language-js extra-class"><pre class="language-js"><code>socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span>
socket<span class="token punctuation">.</span><span class="token function">ping</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span>
socket<span class="token punctuation">.</span><span class="token function">pong</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span>
</code></pre></div><p>Here's a vulnerable socket server with some echo functionality:</p> <div class="language-js extra-class"><pre class="language-js"><code>server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connection'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    message <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'echo'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token comment">// send back the user's message</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><code>socket.send(number)</code> called on the server, will disclose server memory.</p> <p>Here's <a href="https://github.com/websockets/ws/releases/tag/1.0.1" target="_blank" rel="noopener noreferrer">the release<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> where the issue<br>
was fixed, with a more detailed explanation. Props to<br> <a href="https://github.com/3rd-Eden" target="_blank" rel="noopener noreferrer">Arnout Kazemier<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for the quick fix. Here's the<br> <a href="https://nodesecurity.io/advisories/67" target="_blank" rel="noopener noreferrer">Node Security Project disclosure<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h3 id="what-s-the-solution"><a href="#what-s-the-solution" class="header-anchor">#</a> What's the solution?</h3> <p>It's important that node.js offers a fast way to get memory otherwise performance-critical<br>
applications would needlessly get a lot slower.</p> <p>But we need a better way to <em>signal our intent</em> as programmers. <strong>When we want<br>
uninitialized memory, we should request it explicitly.</strong></p> <p>Sensitive functionality should not be packed into a developer-friendly API that loosely<br>
accepts many different types. This type of API encourages the lazy practice of passing<br>
variables in without checking the type very carefully.</p> <h4 id="a-new-api-buffer-allocunsafe-number"><a href="#a-new-api-buffer-allocunsafe-number" class="header-anchor">#</a> A new API: <code>Buffer.allocUnsafe(number)</code></h4> <p>The functionality of creating buffers with uninitialized memory should be part of another<br>
API. We propose <code>Buffer.allocUnsafe(number)</code>. This way, it's not part of an API that<br>
frequently gets user input of all sorts of different types passed into it.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> buf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">allocUnsafe</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token comment">// careful, uninitialized memory!</span>

<span class="token comment">// Immediately overwrite the uninitialized buffer with data from another buffer</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> buf<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> otherBuf<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="how-do-we-fix-node-js-core"><a href="#how-do-we-fix-node-js-core" class="header-anchor">#</a> How do we fix node.js core?</h3> <p>We sent <a href="https://github.com/nodejs/node/pull/4514" target="_blank" rel="noopener noreferrer">a PR to node.js core<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (merged as<br> <code>semver-major</code>) which defends against one case:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token number">16</span>
<span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span>
</code></pre></div><p>In this situation, it's implied that the programmer intended the first argument to be a<br>
string, since they passed an encoding as a second argument. Today, node.js will allocate<br>
uninitialized memory in the case of <code>new Buffer(number, encoding)</code>, which is probably not<br>
what the programmer intended.</p> <p>But this is only a partial solution, since if the programmer does <code>new Buffer(variable)</code><br>
(without an <code>encoding</code> parameter) there's no way to know what they intended. If <code>variable</code><br>
is sometimes a number, then uninitialized memory will sometimes be returned.</p> <h3 id="what-s-the-real-long-term-fix"><a href="#what-s-the-real-long-term-fix" class="header-anchor">#</a> What's the real long-term fix?</h3> <p>We could deprecate and remove <code>new Buffer(number)</code> and use <code>Buffer.allocUnsafe(number)</code> when<br>
we need uninitialized memory. But that would break 1000s of packages.</p> <p><s>We believe the best solution is to:</s></p> <p><s>1. Change <code>new Buffer(number)</code> to return safe, zeroed-out memory</s></p> <p><s>2. Create a new API for creating uninitialized Buffers. We propose: <code>Buffer.allocUnsafe(number)</code></s></p> <h4 id="update"><a href="#update" class="header-anchor">#</a> Update</h4> <p>We now support adding three new APIs:</p> <ul><li><code>Buffer.from(value)</code> - convert from any type to a buffer</li> <li><code>Buffer.alloc(size)</code> - create a zero-filled buffer</li> <li><code>Buffer.allocUnsafe(size)</code> - create an uninitialized buffer with given size</li></ul> <p>This solves the core problem that affected <code>ws</code> and <code>bittorrent-dht</code> which is<br> <code>Buffer(variable)</code> getting tricked into taking a number argument.</p> <p>This way, existing code continues working and the impact on the npm ecosystem will be<br>
minimal. Over time, npm maintainers can migrate performance-critical code to use<br> <code>Buffer.allocUnsafe(number)</code> instead of <code>new Buffer(number)</code>.</p> <h3 id="conclusion"><a href="#conclusion" class="header-anchor">#</a> Conclusion</h3> <p>We think there's a serious design issue with the <code>Buffer</code> API as it exists today. It<br>
promotes insecure software by putting high-risk functionality into a convenient API<br>
with friendly &quot;developer ergonomics&quot;.</p> <p>This wasn't merely a theoretical exercise because we found the issue in some of the<br>
most popular npm packages.</p> <p>Fortunately, there's an easy fix that can be applied today. Use <code>safe-buffer</code> in place of<br> <code>buffer</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> Buffer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'safe-buffer'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Buffer
</code></pre></div><p>Eventually, we hope that node.js core can switch to this new, safer behavior. We believe<br>
the impact on the ecosystem would be minimal since it's not a breaking change.<br>
Well-maintained, popular packages would be updated to use <code>Buffer.alloc</code> quickly, while<br>
older, insecure packages would magically become safe from this attack vector.</p> <h2 id="links"><a href="#links" class="header-anchor">#</a> links</h2> <ul><li><a href="https://github.com/nodejs/node/pull/4514" target="_blank" rel="noopener noreferrer">Node.js PR: buffer: throw if both length and enc are passed<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://nodesecurity.io/advisories/67" target="_blank" rel="noopener noreferrer">Node Security Project disclosure for <code>ws</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://nodesecurity.io/advisories/68" target="_blank" rel="noopener noreferrer">Node Security Project disclosure for<code>bittorrent-dht</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="credit"><a href="#credit" class="header-anchor">#</a> credit</h2> <p>The original issues in <code>bittorrent-dht</code><br>
(<a href="https://nodesecurity.io/advisories/68" target="_blank" rel="noopener noreferrer">disclosure<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>) and<br> <code>ws</code> (<a href="https://nodesecurity.io/advisories/67" target="_blank" rel="noopener noreferrer">disclosure<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>) were discovered by<br> <a href="https://github.com/mafintosh" target="_blank" rel="noopener noreferrer">Mathias Buus<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and<br> <a href="http://feross.org/" target="_blank" rel="noopener noreferrer">Feross Aboukhadijeh<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>Thanks to <a href="https://github.com/evilpacket" target="_blank" rel="noopener noreferrer">Adam Baldwin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for helping disclose these issues<br>
and for his work running the <a href="https://nodesecurity.io/" target="_blank" rel="noopener noreferrer">Node Security Project<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>Thanks to <a href="https://github.com/jhiesey" target="_blank" rel="noopener noreferrer">John Hiesey<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for proofreading this README and<br>
auditing the code.</p> <h2 id="license"><a href="#license" class="header-anchor">#</a> license</h2> <p>MIT. Copyright (C) <a href="http://feross.org" target="_blank" rel="noopener noreferrer">Feross Aboukhadijeh<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2e3db3d9.js" defer></script><script src="/assets/js/2.65dda3ac.js" defer></script><script src="/assets/js/151.809252f7.js" defer></script>
  </body>
</html>
